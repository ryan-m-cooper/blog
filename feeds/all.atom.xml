<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Maptastik!</title><link href="http://ryan-m-cooper.com/blog/" rel="alternate"></link><link href="http://ryan-m-cooper.com/blog/feeds/all.atom.xml" rel="self"></link><id>http://ryan-m-cooper.com/blog/</id><updated>2018-01-14T22:15:00-05:00</updated><entry><title>Remote GeoJSON to GeoDataFrame</title><link href="http://ryan-m-cooper.com/blog/remote-geojson-to-geodataframe.html" rel="alternate"></link><published>2018-01-14T16:56:00-05:00</published><updated>2018-01-14T16:56:00-05:00</updated><author><name>Ryan Cooper</name></author><id>tag:ryan-m-cooper.com,2017-11-01:blog/remote-geojson-to-geodataframe.html</id><summary type="html">&lt;h1&gt;Remote GeoJSON to GeoDataFrame&lt;/h1&gt;
&lt;p&gt;I’m inspired by Stephen Smith’s &lt;a href="https://medium.com/@TheMapSmith/messin-around-with-maps-ce3a3ffd86c"&gt;quick post&lt;/a&gt; about rapid prototyping during his lunch break. Lately I’ve been using my lunch break to watch videos that are both related to the work I do for the City of Raleigh Park, Recreation &amp;amp; Cultural Resources Department and of interest to me. But sometimes I’d rather just mess around while I eat my turkey sandwich. I did just that today.&lt;/p&gt;
&lt;p&gt;We’re an Esri shop here at City of Raleigh, so most of my day-to-day is spent in that ecosystem. That said, I’ve been really interested in the Python library &lt;strong&gt;&lt;a href="http://geopandas.org/index.html"&gt;geopandas&lt;/a&gt;&lt;/strong&gt; for a bit now and wanted to spend my lunch with it.&lt;/p&gt;
&lt;p&gt;One thing that’s great about geopandas is that you can read in all sorts of different data using &lt;code&gt;gpd.read_file()&lt;/code&gt;. That’s great if you have a Shapefile or some GeoJSON on your machine. But what if you want to pull in some data from a URL? &lt;code&gt;gpd.read_file()&lt;/code&gt; isn’t going to work.&lt;/p&gt;
&lt;p&gt;So during lunch I messed around (e.g. Wrote some Python using &lt;a href="https://github.com/spyder-ide"&gt;Spyder&lt;/a&gt;, Googled things, ducked into &lt;a href="https://stackoverflow.com/questions/37728540/create-a-geodataframe-from-a-geojson-object"&gt;Stack Overflow&lt;/a&gt;) and cobbled together a little function that takes a URL pointing to some GeoJSON as an input and returns a GeoDataFrame:&lt;/p&gt;
&lt;div class="gist"&gt;
    &lt;script src='https://gist.github.com/6030df87e8bd62fa583a83ecea9fceab.js'&gt;&lt;/script&gt;
    &lt;noscript&gt;
        &lt;pre&gt;&lt;code&gt;import requests, json, geopandas as gpd

def remoteGeoJSONToGDF(url, display = False):
    """Import remote GeoJSON to a GeoDataFrame
    Keyword arguments:
    url -- URL to GeoJSON resource on web
    display -- Displays geometries upon loading (default: False)
    """
    r = requests.get(url)
    data = r.json()
    gdf = gpd.GeoDataFrame.from_features(data['features'])
    if display:
        gdf.plot()
    return gdf&lt;/code&gt;&lt;/pre&gt;
    &lt;/noscript&gt;
&lt;/div&gt;
&lt;p&gt;What’s going on here? We use &lt;strong&gt;&lt;a href="http://docs.python-requests.org/en/master/"&gt;requests&lt;/a&gt;&lt;/strong&gt; to get our GeoJSON from the URL we pass. We then create a GeoDataFrame, &lt;code&gt;gdf&lt;/code&gt;, by using &lt;code&gt;gpd.GeoDataFrame.from_features()&lt;/code&gt; iterate through the features in our GeoJSON. Finally, we return &lt;code&gt;gdf&lt;/code&gt; so that we can access our newly created GeoDataFrame for plotting or doing further analysis. There’s also an option to plot the result if you want. Just set &lt;code&gt;display&lt;/code&gt; to &lt;code&gt;True&lt;/code&gt; when you call the function.&lt;/p&gt;
&lt;p&gt;For example, let’s say we want to look at the City of Raleigh council districts:&lt;/p&gt;
&lt;div class="gist"&gt;
    &lt;script src='https://gist.github.com/803cbff714ca3353b62baa2c612905ee.js'&gt;&lt;/script&gt;
    &lt;noscript&gt;
        &lt;pre&gt;&lt;code&gt;districts = remoteGeoJSONToGDF('http://data-ral.opendata.arcgis.com/datasets/9a5733e13dd14e2f80f8517738ce8cc6_2.geojson')
districts.plot(column = 'COUNCIL_DIST')&lt;/code&gt;&lt;/pre&gt;
    &lt;/noscript&gt;
&lt;/div&gt;
&lt;p&gt;In line 1 we pass the URL of council district GeoJSON on &lt;a href="http://data-ral.opendata.arcgis.com/"&gt;Raleigh’s open data site&lt;/a&gt; and assign the returned GeoDataFrame to a variable, &lt;code&gt;districts&lt;/code&gt;. We can then use geopandas (but really matplotlib) to plot the GeoDataFrame.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Plot of Raleigh city council districts generated from remote GeoJSON" src="http://ryan-m-cooper.com/blog/images/remote-geojson-to-geodataframe_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;This is a pretty narrow use case for this code and I’m sure there are lots of ways to bork it. Still, I hope you find it useful!&lt;/p&gt;</summary><category term="geopandas"></category><category term="geojson"></category><category term="Python Pandas"></category><category term="Python"></category></entry><entry><title>Loading External GeoJSON: A(nother) Way to Do It with jQuery</title><link href="http://ryan-m-cooper.com/blog/loading-external-geojson.html" rel="alternate"></link><published>2018-01-14T22:15:00-05:00</published><updated>2018-01-14T22:15:00-05:00</updated><author><name>Ryan Cooper</name></author><id>tag:ryan-m-cooper.com,2017-02-08:blog/loading-external-geojson.html</id><summary type="html">&lt;h1&gt;Loading External GeoJSON: A(nother) Way to Do It with jQuery&lt;/h1&gt;
&lt;p&gt;It’s a common mistake for those of us getting into making maps with Leaflet: After running through a few examples, the excited mapper is ready to make a visualization from their own data. We get everything set-up and call &lt;code&gt;L.geoJSON()&lt;/code&gt; on some data onto a web server. &lt;em&gt;CTRL+S…F5…&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="Code and console showing what happens if you try to load GeoJSON from a URL using the L.geoJSON function in Leaflet" src="http://ryan-m-cooper.com/blog/images/loading-external-geojson_1.png" /&gt;&lt;/p&gt;
&lt;p&gt;Let me just get this admission out of the way: I don’t really understand asynchronous loading or callbacks. As such, I spend a lot of time that could be dedicated to learning about asynchronous loading and callbacks instead trying to find ways to load data in the more linear, step-wise fashion. Here’s what I want to do:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Get some external data&lt;/li&gt;
&lt;li&gt;Make a map with that data&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I like using GeoJSON as my data format for map data, but I don’t like hard-coding it into my map script. I want to load it from somewhere else and assign it a variable within my map script because that’s how &lt;a href="http://leafletjs.com/examples/geojson/"&gt;the official tutorial on using GeoJSON in Leaflet&lt;/a&gt; more or less suggests I could do it. I also don’t necessarily want to pull my data from the same directory as my project. I want to start each project with the assumption that my data will be coming from an external service because that’s where most of my data is located.&lt;/p&gt;
&lt;p&gt;The problem is that my basic workflow for loading GeoJSON into a map is at odds with my technical ability to use callbacks. What to do? In this post I will demonstrate how I use &lt;code&gt;jQuery.ajax&lt;/code&gt; and jQuery’s &lt;code&gt;.when()&lt;/code&gt;/&lt;code&gt;.done()&lt;/code&gt; functionality to load external GeoJSON into a webmap. We won’t be avoiding asynchronicity or callbacks entirely, but will be taming them in a way that allows us to create a Leaflet map with external data that doesn’t involve a descent into &lt;a href="http://callbackhell.com/"&gt;“callback hell”&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Set up a Map&lt;/h3&gt;
&lt;p&gt;We’ll begin with some boilerplate code to get our map started. We’ll generate afull window map focused on Kentucky using &lt;a href="http://leafletjs.com/download.html"&gt;Leaflet
v1&lt;/a&gt;.&lt;/p&gt;
&lt;div class="gist"&gt;
    &lt;script src='https://gist.github.com/749ca67f1d96f896b1d4c58d7a1e7739.js'&gt;&lt;/script&gt;
    &lt;noscript&gt;
        &lt;pre&gt;&lt;code&gt;&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="utf-8" /&gt;
    &lt;title&gt;Starter map&lt;/title&gt;
    &lt;meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" /&gt;
    &lt;link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" /&gt;
    &lt;style&gt;
        body {
            margin: 0;
            padding: 0;
        }
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    &lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div id="map"&gt;&lt;/div&gt;
    &lt;script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"&gt;&lt;/script&gt;
    &lt;script&gt;
        var map = L.map('map')
            .setView([37.857507, -85.632935], 7);

        var basemap = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
            attribution: '&amp;copy; &lt;a href="http://www.openstreetmap.org/copyright"&gt;OpenStreetMap&lt;/a&gt; &amp;copy; &lt;a href="http://cartodb.com/attributions"&gt;CartoDB&lt;/a&gt;',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);
    &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;
&lt;/code&gt;&lt;/pre&gt;
    &lt;/noscript&gt;
&lt;/div&gt;
&lt;p&gt;&lt;img alt="Our basic starter map." src="http://ryan-m-cooper.com/blog/images/loading-external-geojson_2.png" /&gt;]
(&lt;em&gt;&lt;a href="http://bl.ocks.org/maptastik/raw/749ca67f1d96f896b1d4c58d7a1e7739/"&gt;View full
map&lt;/a&gt;&lt;/em&gt;)&lt;/p&gt;
&lt;h3&gt;Add jQuery&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href="http://jquery.com/"&gt;jQuery&lt;/a&gt;&lt;/strong&gt; has some nice tools that will help us control loading our data and adding it to our map in the order that we want to. I usually load it from &lt;a href="https://developers.google.com/speed/libraries/"&gt;Google’s hosted libraries&lt;/a&gt;, but you could download it from jQuery and host it yourself if you’d like!&lt;/p&gt;
&lt;p&gt;We’ll add jQuery before our map script. I like to include it as the first script in my map placing it just ahead of Leaflet:&lt;/p&gt;
&lt;div class="gist"&gt;
    &lt;script src='https://gist.github.com/c2169793e9cc4f90bbab20cf20a56fc4.js'&gt;&lt;/script&gt;
    &lt;noscript&gt;
        &lt;pre&gt;&lt;code&gt;&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="utf-8" /&gt;
    &lt;title&gt;Starter map&lt;/title&gt;
    &lt;meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" /&gt;
    &lt;link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" /&gt;
    &lt;style&gt;
        body {
            margin: 0;
            padding: 0;
        }
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    &lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div id="map"&gt;&lt;/div&gt;
    &lt;!-- Add jQuery --&gt;
    &lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"&gt;&lt;/script&gt;
    &lt;script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"&gt;&lt;/script&gt;
    &lt;!-- MAP SCRIPT --&gt;
    &lt;script&gt;
        var map = L.map('map')
            .setView([37.857507, -85.632935], 7);

        var basemap = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
            attribution: '&amp;copy; &lt;a href="http://www.openstreetmap.org/copyright"&gt;OpenStreetMap&lt;/a&gt; &amp;copy; &lt;a href="http://cartodb.com/attributions"&gt;CartoDB&lt;/a&gt;',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);
    &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;&lt;/code&gt;&lt;/pre&gt;
    &lt;/noscript&gt;
&lt;/div&gt;
&lt;p&gt;&lt;img alt="Our map with jQuery included. Nothing changed. That’s OK!" src="http://ryan-m-cooper.com/blog/images/loading-external-geojson_2.png" /&gt;
(&lt;em&gt;&lt;a href="http://bl.ocks.org/maptastik/c2169793e9cc4f90bbab20cf20a56fc4"&gt;View full map&lt;/a&gt;)&lt;/em&gt;)&lt;/p&gt;
&lt;p&gt;Our map should look the same as it did earlier. That’s fine. All we did was add jQuery. We haven’t actually asked jQuery to help us do anything though. Let’s change that.&lt;/p&gt;
&lt;h3&gt;Load external data with AJAX&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://developer.mozilla.org/en-US/docs/AJAX/Getting_Started"&gt;&lt;strong&gt;AJAX&lt;/strong&gt;&lt;/a&gt; stands for Asynchronous JavaScript and XML. AJAX allows us to send and receive data as well as update a web page without reloading it. For our case, it allows us to fetch external GeoJSON so that we can add it to our map. While you can use AJAX with vanilla JavaScript, &lt;a href="http://api.jquery.com/jquery.ajax/"&gt;jQuery has a nice set of AJAX tools&lt;/a&gt; that make implementing it, arguably, a little easier.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;ajax&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
    &lt;span class="nx"&gt;url&lt;/span&gt;&lt;span class="o"&gt;:&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;URL&lt;/span&gt; &lt;span class="nx"&gt;to&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;dataType&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;json&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;success&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Data successfully loaded!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="nx"&gt;error&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;xhr&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;xhr&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;statusText&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;For our map, we are going to request some GeoJSON that is located at this &lt;a href="https://gist.githubusercontent.com/maptastik/df8e483d5ac1c6cae3dc4a7c02ea9039/raw/9cd46849bddcfa90aab240772a12275408d6d8d0/kyCounties.geojson"&gt;here&lt;/a&gt;. We will specify a &lt;strong&gt;data type&lt;/strong&gt;, JSON, and provide instructions for what should happen if the request succeeds (&lt;code&gt;success&lt;/code&gt;)or fails (&lt;code&gt;error&lt;/code&gt;). The result of this request will be stored in a variable, &lt;code&gt;counties&lt;/code&gt;. We’ll add this code at the very top of our map script.&lt;/p&gt;
&lt;div class="gist"&gt;
    &lt;script src='https://gist.github.com/fbdbbef6c5ac72fbad775812fdcd9d33.js'&gt;&lt;/script&gt;
    &lt;noscript&gt;
        &lt;pre&gt;&lt;code&gt;&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="utf-8" /&gt;
    &lt;title&gt;Starter map&lt;/title&gt;
    &lt;meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" /&gt;
    &lt;link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" /&gt;
    &lt;style&gt;
        body {
            margin: 0;
            padding: 0;
        }
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    &lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div id="map"&gt;&lt;/div&gt;
    &lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"&gt;&lt;/script&gt;
    &lt;script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"&gt;&lt;/script&gt;
    &lt;!-- MAP SCRIPT --&gt;
    &lt;script&gt;
    // Add AJAX request for data
        var counties = $.ajax({
          url:"https://gist.githubusercontent.com/maptastik/df8e483d5ac1c6cae3dc4a7c02ea9039/raw/9cd46849bddcfa90aab240772a12275408d6d8d0/kyCounties.geojson",
          dataType: "json",
          success: console.log("County data successfully loaded."),
          error: function (xhr) {
            alert(xhr.statusText)
          }
        })
        var map = L.map('map')
            .setView([37.857507, -85.632935], 7);

        var basemap = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
            attribution: '&amp;copy; &lt;a href="http://www.openstreetmap.org/copyright"&gt;OpenStreetMap&lt;/a&gt; &amp;copy; &lt;a href="http://cartodb.com/attributions"&gt;CartoDB&lt;/a&gt;',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);
    &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;
&lt;/code&gt;&lt;/pre&gt;
    &lt;/noscript&gt;
&lt;/div&gt;
&lt;p&gt;&lt;img alt="Map centered on Kentucky" src="http://ryan-m-cooper.com/blog/images/loading-external-geojson_2.png" /&gt;
(&lt;em&gt;&lt;a href="http://bl.ocks.org/maptastik/fbdbbef6c5ac72fbad775812fdcd9d33"&gt;View full map&lt;/a&gt;&lt;/em&gt;)&lt;/p&gt;
&lt;p&gt;What’s happening here? When jQuery makes the AJAX request, it tries to get whatever is at the URL we specified. If there is an error, we get an alert with some information about what went wrong. If the request is successful, we get a little message in our console to tell us so. Ultimately, the variable &lt;code&gt;counties&lt;/code&gt; will be the result of that request and we will be able to continue with our map.&lt;/p&gt;
&lt;p&gt;Our map still won’t look any different, but behind the scenes we’ve done what we need to request the external GeoJSON data we want to add to our map. You can check this by opening your developer tools printing &lt;code&gt;counties&lt;/code&gt; to the console.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;counties&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="The returned value for counties printed to the console" src="http://ryan-m-cooper.com/blog/images/loading-external-geojson_3.png" /&gt;&lt;/p&gt;
&lt;p&gt;You might have expected that &lt;code&gt;counties&lt;/code&gt; would be the raw GeoJSON from the specified URL. It isn’t. Instead, &lt;code&gt;counties&lt;/code&gt; is an &lt;strong&gt;&lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest"&gt;XMLHttpResponse object&lt;/a&gt;&lt;/strong&gt; with a whole lot of information regarding our data request. However, notice the &lt;code&gt;responseJSON&lt;/code&gt; value. We got that property because we set &lt;code&gt;responseType: "json"&lt;/code&gt; in our AJAX request. The resulting value looks a lot like GeoJSON. That’s because it is! We’ll use it shortly.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;.when()&lt;/code&gt; &amp;amp; &lt;code&gt;.done()&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;One of the advantages of AJAX is that your page can load even if the the AJAX request is slow or fails. In our case, we’re trying to wrangle that functionality a bit in order to control the order in which elements of our map load. Specifically, we don’t want our map to load until the data request has finished. The reason for this is that it is possible that the code that draw our map could execute before our data request is finished. If that were to happen, then we would potentially be passing a variable, &lt;code&gt;counties&lt;/code&gt;, that has not yet been fully defined. To ensure that everything loads in the proper order and at the proper time, we can chain two jQuery methods together: &lt;a href="http://api.jquery.com/jQuery.when/"&gt;&lt;code&gt;.when()&lt;/code&gt;&lt;/a&gt; and &lt;a href="http://api.jquery.com/deferred.done/"&gt;&lt;code&gt;.done()&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;script&amp;gt;&lt;/span&gt;
// Load data with .ajax()
$.when(data).done(function(){
  //Do something
});
&lt;span class="nt"&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;In the snippet above we’ve got some data we requested via &lt;code&gt;.ajax()&lt;/code&gt;. We then commanded that &lt;em&gt;when&lt;/em&gt; the &lt;em&gt;data&lt;/em&gt; we requested is &lt;em&gt;done&lt;/em&gt; loading, do something. For our map we’ll request the data like we did earlier, but wrap the rest of the map script in our &lt;code&gt;when&lt;/code&gt;/&lt;code&gt;done&lt;/code&gt; function.&lt;/p&gt;
&lt;div class="gist"&gt;
    &lt;script src='https://gist.github.com/e7ac58edd5f34fb9487faa711ffc4fb8.js'&gt;&lt;/script&gt;
    &lt;noscript&gt;
        &lt;pre&gt;&lt;code&gt;&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="utf-8" /&gt;
    &lt;title&gt;Starter map&lt;/title&gt;
    &lt;meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" /&gt;
    &lt;link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" /&gt;
    &lt;style&gt;
        body {
            margin: 0;
            padding: 0;
        }
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    &lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div id="map"&gt;&lt;/div&gt;
    &lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"&gt;&lt;/script&gt;
    &lt;script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"&gt;&lt;/script&gt;
    &lt;!-- MAP SCRIPT --&gt;
    &lt;script&gt;
        var counties = $.ajax({
          url:"https://gist.githubusercontent.com/maptastik/df8e483d5ac1c6cae3dc4a7c02ea9039/raw/9cd46849bddcfa90aab240772a12275408d6d8d0/kyCounties.geojson",
          dataType: "json",
          success: console.log("County data successfully loaded."),
          error: function (xhr) {
            alert(xhr.statusText)
          }
        })
        // Specify that this code should run once the county data request is complete
        $.when(counties).done(function() {
            var map = L.map('map')
                .setView([37.857507, -85.632935], 7);

            var basemap = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
                attribution: '&amp;copy; &lt;a href="http://www.openstreetmap.org/copyright"&gt;OpenStreetMap&lt;/a&gt; &amp;copy; &lt;a href="http://cartodb.com/attributions"&gt;CartoDB&lt;/a&gt;',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);
        });
    &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;
&lt;/code&gt;&lt;/pre&gt;
    &lt;/noscript&gt;
&lt;/div&gt;
&lt;p&gt;&lt;img alt="This map looks the same as the others, but this time the request for our GeoJSON data was completed before the rest of the map was drawn." src="http://ryan-m-cooper.com/blog/images/loading-external-geojson_2.png" /&gt;
(&lt;em&gt;&lt;a href="http://bl.ocks.org/maptastik/e7ac58edd5f34fb9487faa711ffc4fb8"&gt;View full map&lt;/a&gt;&lt;/em&gt;)&lt;/p&gt;
&lt;p&gt;Again, our map won’t look any different than it did before, but behind the scenes there is a different story. If we look at our previous map, our data request and rendering of our map happened at the same time. In fact, the map rendering finished before the data request was completed!&lt;/p&gt;
&lt;p&gt;&lt;img alt="A look at the network response without AJAX" src="http://ryan-m-cooper.com/blog/images/loading-external-geojson_4.png" /&gt;&lt;/p&gt;
&lt;p&gt;By using &lt;code&gt;.when()&lt;/code&gt; and &lt;code&gt;.done()&lt;/code&gt;, we’ve made it so the map does not render until the data request is completed.&lt;/p&gt;
&lt;p&gt;&lt;img alt="A look at the network response with AJAX" src="http://ryan-m-cooper.com/blog/images/loading-external-geojson_5.png" /&gt;&lt;/p&gt;
&lt;h3&gt;Adding External GeoJSON to the Map&lt;/h3&gt;
&lt;p&gt;Now that we’ve set up our app to request the external data first and the rest of the map after that request has has completed, we can finally get to mashing our data onto our map.&lt;/p&gt;
&lt;p&gt;With Leaflet, we can use &lt;a href="http://leafletjs.com/reference-1.0.3.html#geojson"&gt;&lt;code&gt;L.geoJSON()&lt;/code&gt;&lt;/a&gt; to add GeoJSON data to a map. Earlier, when we made our AJAX request for data, we stored the result in a variable, &lt;code&gt;counties&lt;/code&gt;. But if we call…&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nx"&gt;L&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;geoJSON&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;counties&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;addTo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;…we will get an error. Why? Because the value of &lt;code&gt;counties&lt;/code&gt; is not the raw GeoJSON located at the URL we passed to our request. It is an &lt;code&gt;XMLHttpRequest&lt;/code&gt; object that contains information about the request. One of the properties of that object is &lt;code&gt;responseJSON&lt;/code&gt;. We looked at earlier and thought it looked a lot like GeoJSON. What if we try accessing that property with &lt;code&gt;L.geoJSON()&lt;/code&gt;?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nx"&gt;L&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;geoJSON&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;counties&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;responseJSON&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;addTo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Assuming our data request is successful, we should get a map of Kentucky counties with Leaflet’s default blue styling.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Map of Kentucky counties with data loaded from external GeoJSON" src="http://ryan-m-cooper.com/blog/images/loading-external-geojson_6.png" /&gt;&lt;/p&gt;
&lt;p&gt;(&lt;em&gt;(&lt;a href="http://bl.ocks.org/maptastik/00312131250f9c8b534d97d1be258f1a"&gt;View full map&lt;/a&gt;&lt;/em&gt;)&lt;/p&gt;
&lt;div class="gist"&gt;
    &lt;script src='https://gist.github.com/00312131250f9c8b534d97d1be258f1a.js'&gt;&lt;/script&gt;
    &lt;noscript&gt;
        &lt;pre&gt;&lt;code&gt;&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset="utf-8" /&gt;
    &lt;title&gt;A simple map&lt;/title&gt;
    &lt;meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" /&gt;
    &lt;link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" /&gt;
    &lt;style&gt;
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    &lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div id="map"&gt;&lt;/div&gt;
    &lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"&gt;&lt;/script&gt;
    &lt;script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"&gt;&lt;/script&gt;
    &lt;script&gt;
        var counties = $.ajax({
            url: "https://gist.githubusercontent.com/maptastik/df8e483d5ac1c6cae3dc4a7c02ea9039/raw/9cd46849bddcfa90aab240772a12275408d6d8d0/kyCounties.geojson",
            dataType: "json",
            success: console.log("County data successfully loaded."),
            error: function(xhr) {
                alert(xhr.statusText)
            }
        })
        $.when(counties).done(function() {
            var map = L.map('map')
                .setView([37.857507, -85.632935], 7);

            var basemap = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
                attribution: '&amp;copy; &lt;a href="http://www.openstreetmap.org/copyright"&gt;OpenStreetMap&lt;/a&gt; &amp;copy; &lt;a href="http://cartodb.com/attributions"&gt;CartoDB&lt;/a&gt;',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);
            // Add requested external GeoJSON to map
            var kyCounties = L.geoJSON(counties.responseJSON).addTo(map);
        });
    &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;
&lt;/code&gt;&lt;/pre&gt;
    &lt;/noscript&gt;
&lt;/div&gt;
&lt;p&gt;With our external data now in our map, we can carry on styling the counties and adding more interaction.&lt;/p&gt;
&lt;h3&gt;Concluding Thoughts&lt;/h3&gt;
&lt;p&gt;I recognize that this method is not ideal for all circumstances. I suspect that this may not be a method that scales well. For instance, by waiting for the external data request to be completed before rendering the rest of the map, the load time of the whole map is increased. Under normal circumstances, an approach that allows for the data and rest of the map to load at the same time should decrease the overall load time. Nonetheless, I feel like this approach offers a nice stepping stone towards faster, yet more complicated methods of mapping external GeoJSON data.&lt;/p&gt;
&lt;p&gt;Thinking about Leaflet, the workflow I’ve presented looks similar to the workflow demonstrated in the tutorial &lt;a href="http://leafletjs.com/examples/geojson/"&gt;“Using GeoJSON with Leaflet”&lt;/a&gt;. In that tutorial, GeoJSON is a variable, hard-coded into the map script. That variable is then passed to the &lt;code&gt;L.geoJSON()&lt;/code&gt; method. But I would venture to guess that most people do not want to have huge blocks of GeoJSON text in their script. It is messy looking if you have more than a couple point featuers and is not really sustainable if you have a dataset that changes regularly. Furthermore. the workflow demonstrated in that tutorial does not work if you want to grab external data. You have to figure out a new workflow, one which typically requires callbacks. What I like about the method I’ve presented here is that it is similar to the more linear approach used in beginner tutorials. It may have it’s pitfalls, but it allows someone like me to still be able to make a map while trying to better understand more efficient methods of doing so. I hope this post is useful to you as well.&lt;/p&gt;
&lt;h3&gt;Other Resources&lt;/h3&gt;
&lt;p&gt;There are multiple ways to add external data to a map in Leaflet. Here are a few examples and tool for doing just that:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://lyzidiamond.com/posts/external-geojson-mapbox"&gt;“Adding External GeoJSON with
Mapbox.js”&lt;/a&gt; — Lyzi Diamond&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/calvinmetcalf/leaflet-ajax"&gt;leaflet-ajax&lt;/a&gt; plugin — Calvin Metcalf&lt;/li&gt;
&lt;li&gt;&lt;a href="http://zevross.com/blog/2014/10/28/tips-for-creating-leafleft-js-maps/"&gt;“Creating a Leaflet.js mapping app from the ground up”&lt;/a&gt; — Zev Ross&lt;/li&gt;
&lt;li&gt;&lt;a href="https://maptimeboston.github.io/leaflet-intro/"&gt;“Leaflet: Make a web map!”&lt;/a&gt; — Ryan Mullins &amp;amp; Andy Woodruff (maptimeBoston)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you want to avoid using jQuery, I’d recommend checking out &lt;a href="http://youmightnotneedjquery.com/"&gt;“YOU MIGHT NOT NEED JQUERY”&lt;/a&gt;.&lt;/p&gt;</summary><category term="geojson"></category><category term="jQuery"></category><category term="JavaScript"></category><category term="LeafletJS"></category><category term="web maps"></category></entry></feed>